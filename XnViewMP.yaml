name: XnViewMP
buildsystem: simple
sources:
  - type: archive
    url: https://download.xnview.com/old_versions/XnViewMP-1010-linux-x64.tgz
    sha256: 6b02feeece34a60c086a6e54f5259f7a0f048b1f9c1e3defde9684b84a246fd3
    strip-components: 0
  # Icons, desktop file and metainfo
  - type: dir
    path: data
build-commands:
  - |
    find "XnView" -xtype f -executable \( -iname '*.jpg' -o -iname '*.png' -o -iname '*.txt' -o -iname '*.zip' \) -exec chmod -x {} +;
    cp -a "XnView" "${FLATPAK_DEST}/";
    mkdir "${FLATPAK_DEST}/bin";
    ln -s "${FLATPAK_DEST}/XnView/xnview.sh" "${FLATPAK_DEST}/bin/xnview";
  - ln -s /usr/lib/x86_64-linux-gnu/libbz2.so.1.0.8 "${FLATPAK_DEST}/XnView/lib/libbz2.so.1.0";
  - |
    for file in $(find share -type f -name *.*); do
        install -p -D -m 0644 "${file}" "${FLATPAK_DEST}/${file}";
    done;
